<p align="center">
  <h1 align="center">
  NodeHexa 六足机器人语音控制板
  </h1>
</p>

## 简介

NodeHexa 是一个基于 ESP32-S3 的六足机器人语音控制扩展板，作为六足机器人主板的智能语音交互模块。它集成了小智 AI 语音助手，能够通过自然语言与用户对话，并将语音指令转换为运动控制命令，通过 UART 串口通信发送给六足机器人主板，从而实现语音控制六足机器人的功能。

- 🤖 **六足机器人项目**: [NodeHexa](https://github.com/ViolinLee/NodeHexa)
- 🎥 **功能演示视频**: [《我用小智来控制六足机器人！智能体交互体验真很不错~》](https://www.bilibili.com/video/BV1wgpAzXE3F)

## 硬件规格

- **主控芯片**: ESP32-S3 (双核 Xtensa LX7，主频 240MHz)
- **内存**: 512KB SRAM + 8MB PSRAM
- **存储**: 16MB Flash
- **音频**: 内置 I2S 音频处理，支持麦克风输入和扬声器输出
- **通信接口**: UART (115200 波特率) 与主板通信
- **电源**: USB-C 供电或外部 5V 供电
- **尺寸**: 紧凑设计，适配六足机器人机身

## 功能特性

### 🎙️ 语音交互
- **唤醒词检测**: 支持"你好小智"唤醒
- **语音识别**: 实时语音转文字
- **自然语言理解**: 理解用户的运动控制指令
- **语音合成**: 文字转语音回复用户

### 🚶 运动控制
NodeHexa 支持丰富的六足机器人运动模式：

| 运动模式 | 指令 | 描述 |
|---------|------|------|
| **基础移动** | FORWARD | 向前行走 |
| | FORWARDFAST | 快速向前 |
| | BACKWARD | 向后行走 |
| **转向** | TURNLEFT | 左转 |
| | TURNRIGHT | 右转 |
| **横移** | SHIFTLEFT | 左侧移 |
| | SHIFTRIGHT | 右侧移 |
| **高级动作** | CLIMB | 攀爬模式 |
| | ROTATEX | X轴旋转 |
| | ROTATEY | Y轴旋转 |
| | ROTATEZ | Z轴旋转 |
| | TWIST | 扭转动作 |
| **状态** | STANDBY | 待机状态 |

### 🔌 通信协议
- **接口**: UART1 (GPIO17-TX, GPIO18-RX)
- **波特率**: 115200
- **数据格式**: JSON 格式指令传输
- **响应机制**: 支持命令确认和状态反馈

## 语音指令示例

NodeHexa 通过 MCP (Model Context Protocol) 工具实现语音控制，支持两类机器人控制：

### 🤖 机器人位置控制
用户可以通过自然语言控制六足机器人的位置移动：

- **基础移动**: "向前走" / "后退" / "快点向前"
- **转向控制**: "左转" / "右转" / "转个身"
- **横移动作**: "向左移动" / "向右平移"
- **特殊移动**: "爬上去"
- **状态控制**: "停下" / "待机" / "准备"

### �� 机器人姿态控制
用户可以通过自然语言控制六足机器人的身体姿态：

- **旋转动作**: "绕X轴旋转" / "绕Y轴旋转" / "绕Z轴旋转"
- **身体动作**: "扭动身体" / "转圈"

### 🚀 自定义控制
NodeHexa 的语音控制基于 MCP 工具实现，开发者可以根据需要自定义控制指令。例如：
- 修改现有的运动控制指令
- 实现更灵活的控制逻辑，如根据对话人的情绪调整机器人行为

通过修改 `nodehexa_board.cc` 中的 MCP 工具定义，可以实现更灵活和个性化的机器人控制体验。  

## 烧录步骤

### 方法一：使用 release.py 脚本（推荐）

推荐使用编译脚本编译。

1. **编译**

```bash
python ./scripts/release.py nodehexa
```

2. **烧录监视**

```bash
idf.py flash monitor
```

### 方法二：手动编译烧录

1. **配置项目**

```bash
idf.py set-target esp32s3
idf.py menuconfig
```

打开配置界面后，参考 `esp-hi/config.json` 修改 menuconfig 对应选项。

2. **编译烧录监视**

```bash
idf.py build flash monitor
```

## 硬件连接

### ESP32-S3 引脚配置

| 功能 | GPIO | 描述 |
|------|------|------|
| **音频输入** | GPIO4 (WS) | I2S 麦克风字选择 |
| | GPIO5 (SCK) | I2S 麦克风时钟 |
| | GPIO6 (DIN) | I2S 麦克风数据输入 |
| **音频输出** | GPIO7 (DOUT) | I2S 扬声器数据输出 |
| | GPIO15 (BCLK) | I2S 扬声器位时钟 |
| | GPIO16 (LRCK) | I2S 扬声器左右声道选择 |
| **通信** | GPIO17 (TX) | UART 发送（连接主板 RX） |
| | GPIO18 (RX) | UART 接收（连接主板 TX） |
| **控制** | GPIO0 | Boot 按钮 |

### 与主板连接

```
NodeHexa ESP32-S3    六足机器人主板
    GPIO17 (TX)  <-->  RX
    GPIO18 (RX)  <-->  TX
    GND          <-->  GND
    5V           <-->  5V
```

## 开发调试

### 串口测试工具

项目提供了 Python 测试脚本用于调试串口通信：

```bash
python test_serial.py /dev/ttyUSB0
```

支持两种测试模式：
1. **自动测试**: 自动执行所有运动命令
2. **交互模式**: 手动输入命令进行测试


## 小智后台配置

后台配置比较灵活随意，但是最好让智能体知道它是六足机器人的“大脑”！以下是一个角色设定示例：

> **我的身份**：
> 我是 NodeHexa 六足机器人的语音控制助手，是机器人的大脑。我喜欢和用户聊天能够理解用户的运动控制指令并控制机器人执行相应动作。
> 
> **我的能力**：
> - **位置控制**：前进、后退、快速前进、左转、右转、左侧移、右侧移、攀爬
> - **姿态控制**：绕X/Y/Z轴旋转、扭动身体
> - **状态管理**：待机、停止
>
> **交互特点**：
> - 我会根据用户指令选择合适的运动模式
> - 执行动作前会确认指令内容
> - 动作完成后会报告执行结果
> - 遇到无法理解的指令时会请求澄清

**注意**: NodeHexa 需要与六足机器人主板配合使用，请确保主板固件支持相应的 UART 通信协议。
